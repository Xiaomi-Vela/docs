# 跨应用数据共享

数据共享提供了向其他应用共享以及管理其数据的方法，支持不同应用之间的数据协同。

在许多应用场景中都需要用到数据共享，比如将电话簿、短信、媒体库中的数据共享给其他应用等。当然，不是所有的数据都允许其他应用访问，比如帐号、密码等；有些数据也只允许其他应用查询而不允许其删改，比如短信等。所以针对不同数据共享场景以及数据隐私保护，设计一个安全、便捷的跨应用数据共享机制是十分必要的。

# 基本概念

在进行跨应用数据共享开发前，先了解以下相关概念。

- **数据提供方**：提供数据及实现相关业务的应用程序，也称为生产者或服务端。

- **数据访问方**：访问数据提供方所提供的数据或业务的应用程序，也称为消费者或客户端。

- **数据集**：用户要插入的数据集合，可以是一条或多条数据。数据集以键值对的形式存在，键为字符串类型，值支持数字、字符串、布尔值、无符号整型数组等多种数据类型。

- **结果集**：用户查询之后的结果集合，其提供了灵活的数据访问方式，以便用户获取各项数据。

- **谓词**：用户访问数据库中的数据所使用的筛选条件，经常被应用在更新数据、删除数据和查询数据等场景。

- **私有数据**：指应用管理的私有数据，该类数据的管理和使用遵循应用定义的准则，由应用规约该类数据的访问方式以及需要的权限。

- **公有数据**：指应用托管到数据管理服务的数据，该类数据由应用和数据管理服务共同管理，遵循应用和数据管理服务规约的数据访问形式，权限管理和生命周期管理。

## 应用私有数据共享

数据提供方无需进行繁琐的封装，可直接使用DataShare向其他应用共享数据；对数据访问方来说，因DataShare的访问方式不会因数据提供的方式而不同，只需要学习和使用一套接口即可，大大减少了学习时间和开发难度。

跨应用数据共享有两种方式：

- **使用DataShareExtensionAbility实现数据共享**

  这种方式通过在HAP中实现一个extension，在extension中可以实现回调，在访问方调用对应接口时，会自动拉起提供方对应的extension，并调用对应回调。

  这种方式适用于跨应用数据访问时有业务的操作，不仅是对数据库的增删改查的情况。

- **通过静默访问实现数据共享**

  这种方式通过在HAP中配置数据库的访问规则，在访问方调用对应接口时，会自动通过系统服务读取HAP配置规则，按照规则返回数据，不会拉起数据提供方。

  这种方式适用于跨应用数据访问仅为数据库的增删改查，没有特殊业务的情况。

## 公有数据共享

区别于应用私有数据的共享，统一数据管理框架（Unified Data Management Framework, UDMF）提供一种新的数据共享与交互方式，应用可以根据UDMF提供的标准化接口，
将数据写入UDMF不同的数据通道。写入UDMF中的数据依据应用定义的权限、数据通道定义的权限以及整个UDMF框架定义的权限管理逻辑进行管理，
写入通道中的数据的生命周期的管理也遵循上述逻辑。这样离散在各个应用的碎片化数据可以在UDMF的不同通道中形成聚合效应，提升开发者跨应用数据协同的效率，同时提升用户的数据体验。

### 标准化数据定义

当出现多应用数据共享时，需要统一的OpenHarmony数据语言，构建OpenHarmony数据跨应用、跨设备交互标准，降低应用/业务数据交互成本，公有数据共享遵循以下数据定义：

**基础数据类型：** File、Text等，能够进行跨应用、跨设备以及跨平台流转，如图1和图2所示。

**图1** UDMF File数据类型示意图

![UDMF_FILE](figures/udmf_type_File.png)

**图2** UDMF Text数据类型示意图

![UDMF_TEXT](figures/udmf_type_Text.png)

**系统相关数据类型（System Defined Type, SDT）：** 与具体的平台/操作系统绑定，如Form（UI卡片信息）、AppItem（App描述信息）、PixelMap（缩略图格式）等，该类数据可以实现系统/平台内的跨应用、跨设备流转，如图3所示。

**图3** UDMF SDT数据类型示意图

![UDMF_SDT](figures/udmf_type_SDT.png)

**应用自定义数据类型（App Defined Type, ADT）：** 单个应用自定义的数据，该类数据可以实现应用内的跨平台与跨设备流转，如图4所示为例，应用可自定义MyFile类型文件格式在应用生态内部使用。

**图4** UDMF ADT数据类型示意图

![UDMF_ADT](figures/udmf_type_ADT.png)

### 标准化数据通路

同时，UDMF提供安全、标准化数据通路，支持标准化数据接入与读取，降低业务跨应用数据交互成本。

UDMF中数据通路以及通路中数据统一管理的URI定义为udmf://intension/bundleName/groupName/guid，其中各组成部分的含义分别为：
**udmf:** 协议名，表示使用UDMF提供的数据通路。  
**intension:** 通道分类，对应不同的业务场景（如数据拖拽）。  
**bundleName:** 数据来源应用的包名称。  
**groupName:** 分组名称，支持批量数据分组管理。  
**guid:** 系统生成的数据id，全局唯一。

当前UDMF中的跨应用数据共享通道有：

- **拖拽数据共享通道**

当用户发起拖拽时，应用（数据提供方）可以通过UDMF提供的统一接口将拖拽数据写入到UDMF的拖拽通道中，并由UDMF统一进行数据的管理，包括访问权限、生命周期等。
同时在完成必要的权限校验后，目标应用（数据访问方）可以通过UDMF提供的标准化接口进行数据的访问。数据被读取后，UDMF会统一对数据的生命周期进行管理。